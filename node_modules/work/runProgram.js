/**
 * Created by lyle on 14-4-14.
 */

exports.runProgram = function(socket)
{
    var exeFile = require('./staticVar.js').getBinaryFile();
    var spawn  = require('child_process').spawn;

    var program = spawn(exeFile);
    var re = "";
    console.log("开始执行");
    program.stdout.setEncoding('utf8');
    program.stderr.setEncoding('utf8');

    program.stderr.on('data',function(data)
    {
        re= re+data;

        program.on('exit',function(code,signal){
            console.log(re);
            var status = {
                index:6,
                detailString:"代码执行出错",
                runResult:re
            };
            socket.emit('status',status);
        });
    });
    program.stdout.on('data',function(data)
    {
        re=re+data;
        program.stdout.on('end',function(){
            console.log(re);
            var status = {
                index:7,
                detailString:"代码执行成功",
                runResult:re
            };
            socket.emit('status',status);
        });

    });
};