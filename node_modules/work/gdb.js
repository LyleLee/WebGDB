/**
 * Created by lyle on 14-4-13.
 */

/*命令传到gdb,进行交互*/
exports.interactive = function(socket)
{
    var staticVar = require('./staticVar.js');
    var spawn = require("child_process").spawn;
    var binaryFile = staticVar.getBinaryFile();
    var gdb = spawn('gdb',[binaryFile]);

    gdb.stdout.setEncoding('utf8');
    gdb.stderr.setEncoding('utf8');
    gdb.stdin.setEncoding('utf8');

    console.log("开始调试");
    /*又是异步事件的原因*/
    gdb.stderr.on('data',function(data)
    {
        socket.emit('executeError',{commandResult:data});
        return false;
    });

    gdb.stdout.on('data',function(data)
    {
        console.log(">>>>"+data);
        socket.emit('executeSuccess',{commandResult:data});
    });

    socket.on('command',function(commandObject)
    {
        /*这里调试一下顺序比较好一些, 上面可能在执行下面的命令之前就有数据输出了*/
        console.log("*****************************\n"+commandObject.com);
        gdb.stdin.write(commandObject.com+"\n");
    });
};
